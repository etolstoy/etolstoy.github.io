<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Fabricio &middot; 
    
  </title>

  
    <meta name="description" content="Fetching Fabric.io statistics using Ruby gem fabricio." />
  

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/etolstoy.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  <!-- Icons -->
  <link rel="apple-touch-icon" sizes="57x57" href="/public/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/public/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/public/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/public/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/public/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/public/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/public/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/public/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/public/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/public/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/public/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/public/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/public/icons/favicon-16x16.png">
  <link rel="shortcut icon" href="/public/icons/favicon.ico">
  <link rel="manifest" href="/public/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/public/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- Disqus -->
  <script id="dsq-count-scr" src="//etolstoy.disqus.com/count.js" async></script>
</head>


  <body class="theme-etolstoy">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="">
        <img src="http://www.gravatar.com/avatar/?s=130" class="image-circle" />
      </a>  
      <h1>
        <a href="">
          
        </a>
      </h1>
      <p class="lead">Egor Tolstoy personal page</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="">Blog</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/about/">About</a>
          
        
      
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/speaking/">Speaking</a>
          
        
      
        
      
        
      
      <a class="sidebar-nav-item" target="_blank" href="">GitHub</a>
      <a class="sidebar-nav-item" target="_blank" href="">LinkedIn</a>
    </nav>

    <span class="deprecated"><a href="http://etolstoy.ru/archive" target="_blank">RussianBlog __attribute__ ((deprecated))</a></span>
    <p>&copy; 2018. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
	    <div class="post">
  <h1 class="post-title">Fabricio</h1>
  <span class="post-date">December 19, 2016</span>
  <p><a href="https://fabric.io/home">Fabric.io</a> is a great tool made for mobile application developers. It provides statistics of standard and out-of-memory crashes, active users, audience growth and a lot more. Unfortunately the only official way to work with this data is using Fabric.io website. That means - no automation and no integrations with other services.</p>

<p>I decided to fix this issue.</p>

<!--more-->

<h2 id="problems">Problems</h2>

<p>Before diving into implementation details let’s see what I mean under <em>no automation and no integrations</em>.</p>

<p>The first problem. We have a dashboard with technical metrics of all our projects. It shows multiple data types from different sources: AppStore ratings, number of unit tests, OCLint reports. Besides it we also count somewhat called ‘project health coefficient’. It reduces all of aforementioned technical metrics in one using a system of weights. The result coefficient varies from <code class="highlighter-rouge">0</code> to <code class="highlighter-rouge">10</code>.</p>

<p>This data is persisted and visualized on our Apple TV in multiple widgets.</p>

<p><img src="https://pbs.twimg.com/media/CvtQNiXXYAAf9Vu.jpg" alt="" /></p>

<p>As for me the most important technical metric of a mobile application is its crashfree rate. It’s the end result of our work, it shows how good we completed our technical tasks. We had to collect this data from Fabric. Showing its own dashboard in an iframe wasn’t an option - we needed the raw data to use it in health coefficient.</p>

<p>The second problem came from our analysts department. They prepare reports of applications status on a regular basis. A report includes different metrics together with the crashfree rate. They had to do a lot of manual work just to collect this data for different time ranges and builds and paste in Excel. We have many apps so it i really hard. They asked me for a better way to deal with it.</p>

<h2 id="research">Research</h2>

<p>We had two major sources to research - Fabric mobile applications and the website. As typical iOS developers with a little background in pentesting we started with researching iOS application. Well, this appeared to be not an easy task. iOS 9 with the brand new <a href="https://developer.apple.com/library/content/releasenotes/General/WhatsNewIniOS/Articles/iOS9.html">ATS</a> didn’t allow us to sniff the https traffic using MitM techniques.</p>

<p>Instead of trying to patch the application we chose an easier way. We found an Android phone. Sniffing its traffic gave us some API methods: OAuth authorization, getting organization and application information. It also provided us a method to obtain crashfree values for a period of time:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"start"</span><span class="p">:</span><span class="w"> </span><span class="mi">1476144000</span><span class="p">,</span><span class="w">
  </span><span class="s2">"limit"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
  </span><span class="s2">"builds"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"all"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="mi">1476144000</span><span class="p">,</span><span class="w">
        </span><span class="mf">0.997496362959705</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="mi">1476230400</span><span class="p">,</span><span class="w">
        </span><span class="mf">0.9964777570356803</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="mi">1476316800</span><span class="p">,</span><span class="w">
        </span><span class="mf">0.9973385101919404</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="err">...</span><span class="w">
</span></code></pre></div></div>

<p>However, time has shown that this data isn’t accurate. The month average crashfree often was different than the percentage shown on the website. I had to deal with the fabric.io site itself. I found that it uses <a href="http://graphql.org/">GraphQL API</a> for some network requests - e.g. crashes count and out-of-memory free metric. Besides it the website provided a lot of other useful API requests - builds information, daily active and active now users and much more.</p>

<h2 id="gem">Gem</h2>

<p>To simplify dealing with multiple endpoints and protocols I wrapped the API in a simple gem - <a href="https://github.com/strongself/fabricio">fabricio</a>. Currently it can do the following things:</p>

<ul>
  <li>Authorize using Fabric.io account, store session and refresh it if needed</li>
  <li>Provide organization data</li>
  <li>Provide applications data</li>
  <li>Provide crash- and out-of-memory- free metrics</li>
  <li>Provide active_now, daily_new and daily_active metrics</li>
  <li>Provide all builds information</li>
  <li>Provide top builds versions</li>
</ul>

<p>Here is how to use it:</p>

<ol>
  <li>Create a <code class="highlighter-rouge">Fabricio::Client</code> object and configure it on initialization.</li>
</ol>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">client</span> <span class="o">=</span> <span class="no">Fabricio</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
      <span class="n">config</span><span class="p">.</span><span class="nf">username</span> <span class="o">=</span> <span class="s1">'your_email'</span>
      <span class="n">config</span><span class="p">.</span><span class="nf">password</span> <span class="o">=</span> <span class="s1">'your_password'</span>
  <span class="k">end</span>
</code></pre></div></div>

<ol>
  <li>Use this client to query any data you want.</li>
</ol>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">client</span><span class="p">.</span><span class="nf">app</span><span class="p">.</span><span class="nf">all</span> <span class="c1"># Returns all applications on your account</span>
  <span class="n">client</span><span class="p">.</span><span class="nf">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s1">'app_id'</span><span class="p">)</span> <span class="c1"># Returns information about specific application</span>
  <span class="n">client</span><span class="p">.</span><span class="nf">app</span><span class="p">.</span><span class="nf">crashfree</span><span class="p">(</span><span class="s1">'app_id'</span><span class="p">,</span> <span class="s1">'1478736000'</span><span class="p">,</span> <span class="s1">'1481328000'</span> <span class="s1">'all'</span><span class="p">)</span> <span class="c1"># Returns application crashfree for a given period of time</span>
  <span class="n">client</span><span class="p">.</span><span class="nf">organization</span><span class="p">.</span><span class="nf">get</span> <span class="c1"># Returns information about your organization</span>
</code></pre></div></div>

<ol>
  <li>If you want to check the exact server output for a model, you can call <code class="highlighter-rouge">json</code> method on it:</li>
</ol>

<p><code class="highlighter-rouge">client.app.get('app_id').json</code></p>

<p>You can call a method similar to any key in this hash:</p>

<p><code class="highlighter-rouge">client.app.get('app_id').importance_level</code></p>

<p>The API is private, so we don’t have any guarantees that it won’t change in the future. I’ll try to keep up with its changes and update the gem ASAP.</p>

<h2 id="api">API</h2>

<p>If you still want to deal with API directly, I posted it in <code class="highlighter-rouge">fabricio</code> repository:</p>
<ul>
  <li><a href="https://github.com/strongself/fabricio/blob/develop/docs/api_reference.md">cURL</a></li>
  <li><a href="https://github.com/strongself/fabricio/blob/develop/docs/swagger-api.json">Swagger</a></li>
</ul>

<h2 id="thanks">Thanks</h2>

<p>My colleagues helped me a lot in my research. Thanks to Vadim Smal who dealt with mobile application sniffing and Irina Dyagileva, Ivan Dyagilev and Andrey Smirnov for help with the website analysis.</p>

<h2 id="links">Links</h2>
<ul>
  <li><a href="https://github.com/strongself/fabricio">fabricio</a></li>
  <li><a href="http://highaltitudehacks.com/2013/08/20/ios-application-security-part-11-analyzing-network-traffic-over-http-slash-https">Sniffing iOS Apps</a></li>
  <li><a href="http://www.digitalinternals.com/mobile/android-sniff-http-https-traffic-without-root/490/">Sniffing Android Apps</a></li>
</ul>

  <br>
  <div class="twitter-promo">
	If you liked this post, you can <a href="https://twitter.com/intent/tweet?url=http://localhost:4000/2016/fabricio/&text=Fabricio&via=igrekde" target="_blank"> share it with your followers</a> or <a href="https://twitter.com/igrekde" target="_blank"> follow me on Twitter</a>!
</div>
</div>

<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
        this.page.url = "http://localhost:4000/2016/fabricio/";
        this.page.identifier = "Fabricio" ;
    };
    (function() {
        var d = document, s = d.createElement('script');
        
        s.src = '//etolstoy.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>  
    </div>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46769640-7', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
